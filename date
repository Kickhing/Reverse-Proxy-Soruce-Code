import os
import time
import ctypes
from datetime import datetime

def set_windows_file_time(file_path, nct):
    FILETIME = ctypes.c_uint64
    creation_time = FILETIME(int(nct * 10000000) + 116444736000000000)
    access_time = creation_time
    write_time = creation_time

    handle = ctypes.windll.kernel32.CreateFileW(
        file_path, 256, 0, None, 3, 128, None
    )

    if handle != -1:
        ctypes.windll.kernel32.SetFileTime(
            handle, ctypes.byref(creation_time),
            ctypes.byref(access_time), ctypes.byref(write_time)
        )
        ctypes.windll.kernel32.CloseHandle(handle)

def change_date(root_folder, new_date):
    file_count = 0
    folder_count = 0
    
    # Unix timestamp for the new date
    nct = time.mktime(new_date.timetuple())
    
    try:
        for root, dirs, files in os.walk(root_folder):
            for file_name in files:
                file_path = os.path.join(root, file_name)
                
                # Set the access and modification times
                os.utime(file_path, (nct, nct))
                
                # Set the creation time (Windows only)
                if os.name == 'nt':
                    set_windows_file_time(file_path, nct)
                
                file_count += 1

            for dir_name in dirs:
                dir_path = os.path.join(root, dir_name)
                
                # Set the access and modification times
                os.utime(dir_path, (nct, nct))
                
                # Set the creation time (Windows only)
                if os.name == 'nt':
                    set_windows_file_time(dir_path, nct)
                
                folder_count += 1
        
        print(f"{file_count} files")
        print(f"{folder_count} folders")
        print("done")
    except Exception as err:
        print(f"err: {err}")

root_folder = r'D:\GitHub\projelerv2\Stealer-RAT-Crypter\Tools\Reverse Proxy\Reverse Proxy'
new_date = datetime(2024, 5, 5)

change_date(root_folder, new_date)
